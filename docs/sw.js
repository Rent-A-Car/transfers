const Static_CACHE_Version="21-02-11",Static_CACHE="static-21-02-11",Static_CACHEAssets=["/","/offline.html","/pages/home.html","/pages/route-info.html","/css/main.css","/css/iconsfont.css","/css/RobotoSlab.css","/css/bootstrap.min.css","/js/main.js","/js/menu.js","/js/ucsv.js","/js/router.js","https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js","/favicon.ico","/icons/android-chrome-192x192.png","/icons/apple-touch-icon-precomposed.png","/icons/GoogleLogo.svg","/css/fonts/iconsfont.woff2","/css/fonts/iconsfont.woff","https://fonts.gstatic.com/s/robotoslab/v12/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISma2RjRdE.woff2","https://fonts.gstatic.com/s/robotoslab/v12/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISmb2Rj.woff2","/manifest.webmanifest"],DCACHE="cache-auto",NoCACHEHosts=["apis.google.com","www.googleapis.com","securetoken.googleapis.com","pagead2.googlesyndication.com","www.googletagservices.com","adservice.google.com","partner.googleadservices.com","tpc.googlesyndication.com","googleads.g.doubleclick.net","adservice.google.me"],NoCACHEPaths=["/TermsOfService","/PrivacyPolicy","/cdn-cgi"];async function checkCache(e){if("GET"==e.method){let t=new URL(e.url),o=e;location.hostname==t.hostname&&(t.search="","/index.html"==t.pathname&&(t.pathname="/"),o=new Request(t.toString(),{cache:e.cache,context:e.context,credentials:e.credentials,headers:e.headers,integrity:e.integrity,method:e.method,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy,body:e.body,bodyUsed:e.bodyUsed}));const s=await caches.open(Static_CACHE);return await s.match(o||e)||checkOnline(o||e)}return await Promise.race([timeout(4600),fetch(e)])}function timeout(e){return new Promise(function(t,o){setTimeout(function(){t(new Response("",{status:408,statusText:"Request timed out."}))},e)})}async function checkOnline(e){const t=await caches.open(DCACHE);try{let o=new URL(e.url);const s=await Promise.race([timeout(3e3),fetch(e)]);if(console.log("fetch to",e.url),!navigator.onLine)throw"Offline";if(408==s.status)throw"Timeout";let c=NoCACHEHosts.includes(o.hostname),a=NoCACHEHosts.filter((e,t,s,c=o.pathname)=>c.match(e)).length>0;return console.log(o.hostname),c||a?console.log("noCACHED"):(await t.put(e,s.clone()),console.log("CACHED")),s}catch(o){console.log(o);const s=await t.match(e);if(s)return s;{let t=new URL(e.url).pathname.match(/\.\w+/);return t&&".html"!=t?new Response(new Blob,{status:503,statusText:"You Offline!"}):await caches.match("/offline.html")}}}self.addEventListener("install",async e=>{self.skipWaiting();const t=await caches.open(Static_CACHE);let o=0;for(var s=0;s<5;s++)try{await t.addAll(Static_CACHEAssets);break}catch(e){console.log(e,o),o+=1}if(5==o)for(s=0;s<Static_CACHEAssets.length;s++)try{await t.add(Static_CACHEAssets[s])}catch(e){console.log(e,Static_CACHEAssets[s])}else console.log("Service worker fetch ok");console.log("Service worker встановлено")}),self.addEventListener("activate",async e=>{const t=(await caches.keys()).map(async e=>{[Static_CACHE].includes(e)||await caches.delete(e)});await Promise.all(t),console.log("Service worker актевовано (видалено застарілий кеш)")}),self.addEventListener("fetch",e=>{e.respondWith(checkCache(e.request))});