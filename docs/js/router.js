String.prototype.formatUnicorn=String.prototype.formatUnicorn||function(){"use strict";var e=this.toString();if(arguments.length){var t,a=typeof arguments[0],o="string"===a||"number"===a?Array.prototype.slice.call(arguments):arguments[0];for(t in o)e=e.replace(new RegExp("\\{"+t+"\\}","gi"),o[t])}return e};const stopLoading=()=>{d.getElementById("pagedataloading").classList.add("d-none")},startLoading=e=>{!e&&setdata2page(""),d.getElementById("pagedataloading").classList.remove("d-none")},setdata2page=e=>{d.getElementById("page-container").innerHTML=e};function searchInRoute(e){searchBody=d.querySelectorAll(".list-group-item").forEach(t=>{t.innerText.toUpperCase().indexOf(e.toUpperCase())>-1||!e?t.parentNode.style.display="flex":t.parentNode.style.display="none"})}const fetchCSV=e=>new Promise((t,a)=>{fetch(e).then(e=>e.text()).then(e=>{t(CSV.csvToObject(e,{trim:!0}))}).catch(e=>{a(e)})});let Oroutedetails=(e,t)=>{go2Page("blank",{control:{title:"",top:"bnn",nav:"h"}}),fetchCSV("https://docs.google.com/spreadsheets/d/e/2PACX-1vROKYurp41BsWy1wIl60L4xRJVpzHC0Cz8ccuSID3s28OtcIUXGvGPBk08y8XowkSBkE7VfFEiegdCa/pub?gid=1463143925&single=true&output=csv").then(a=>{let o={};for(var n=0;n<a.length;n++)a[n].route in o?o[a[n].route].push(a[n]):(o[a[n].route]=[],o[a[n].route].push(a[n]));go2Page("routedetails",{control:{title:o[e][t].drivern+" ("+o[e][t].date+")",top:"bnn",nav:"h"},data:o[e][t]})})},shareRoute=(e,t)=>{navigator.share&&navigator.share({title:"Test",url:"https://arendacg.space/?id"+e}),t.parentElement.parentElement.scrollBy({left:-1,behavior:"smooth"})},rPagehome=()=>{data=fetchCSV("https://docs.google.com/spreadsheets/d/e/2PACX-1vROKYurp41BsWy1wIl60L4xRJVpzHC0Cz8ccuSID3s28OtcIUXGvGPBk08y8XowkSBkE7VfFEiegdCa/pub?gid=1463143925&single=true&output=csv"),temp=fetch("/pages/home.html").then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html").querySelector("[template]"));let e={};finalOutput="",Promise.all([data,temp]).then(o=>{for(var n=0;n<o[0].length;n++)o[0][n].route in e?e[o[0][n].route].push(o[0][n]):(e[o[0][n].route]=[],e[o[0][n].route].push(o[0][n]));for(x in e){r=x.split(";"),t=o[1].cloneNode(!0),crdshhdr=t.querySelector(".flags-shema"),cntry=crdshhdr.querySelector("div"),cntry.setAttribute("country",r[0]);for(n=1;n<r.length;n++)ncntry=cntry.cloneNode(),ncntry.setAttribute("country",r[n]),crdshhdr.append(ncntry);lfr=t.querySelector(".list-group"),a=lfr.firstElementChild,nwa=a.cloneNode(!0),a.innerHTML=a.innerHTML.formatUnicorn(e[x][0]),id=e[x][0].driveru+"-"+e[x][0].date.replaceAll(".","")+"-"+e[x][0].route.replaceAll(";","-"),a.firstElementChild.setAttribute("onclick",'Oroutedetails("'+x+'",0)'),a.querySelector(".slidemenu .share").setAttribute("onclick",'shareRoute("'+id+'",this)');for(n=1;n<e[x].length;n++)tnwa=nwa.cloneNode(!0),id=e[x][n].driveru+"-"+e[x][n].date.replaceAll(".","")+"-"+e[x][n].route.replaceAll(";","-"),tnwa.innerHTML=nwa.innerHTML.formatUnicorn(e[x][n]),tnwa.firstElementChild.setAttribute("onclick",'Oroutedetails("'+x+'",'+n+")"),tnwa.querySelector(".slidemenu .share").setAttribute("onclick",'shareRoute("'+id+'",this)'),lfr.append(tnwa);finalOutput+=t.outerHTML}console.log(o[0],o[1],e),stopLoading(),setdata2page(finalOutput),d.querySelectorAll("div[country]").forEach(e=>{e.style.background="url(https://hatscripts.github.io/circle-flags/flags/"+e.getAttribute("country")+".svg)"})})},rPagedrivers=()=>{data=fetchCSV("https://docs.google.com/spreadsheets/d/e/2PACX-1vROKYurp41BsWy1wIl60L4xRJVpzHC0Cz8ccuSID3s28OtcIUXGvGPBk08y8XowkSBkE7VfFEiegdCa/pub?gid=0&single=true&output=csv&range=B:F"),temp=fetch("/pages/drivers.html").then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html").querySelector("[template]"));let e="";Promise.all([data,temp]).then(t=>{for(driver of(e=t[1].firstElementChild.outerHTML,t[0]))console.log(driver),e+=t[1].lastElementChild.outerHTML.formatUnicorn(driver);stopLoading(),setdata2page(e)})};const PAGEDATA={home:{control:{title:"Рейсы",top:"msn",nav:"s",navTab:"1"}},drivers:{control:{title:"Водители",top:"msn",nav:"s",navTab:"2"}},"add-driver":{control:{title:"Добавить перевозчика",top:"bnn",nav:"h"},back:{page:"home",data:"home"}},calendar:{control:{title:"Календарь",top:"bnn",nav:"h"}}},PAGERENDER={home:rPagehome,drivers:rPagedrivers,calendar:console.log,routedetails:console.log,"add-driver":console.log},PAGESEARCH={home:"searchInRoute",drivers:"console.log"};window.onpopstate=(e=>{e.state&&(console.log("ONPOPSTATE",e.state),go2Page(...e.state))});const curPage=()=>{console.log("curpage");let e=new URL(window.location.href),t="";"page"in sessionStorage?t=sessionStorage.getItem("page"):e.searchParams.has("p")?(p=e.searchParams.get("p").toLowerCase()||"home",window.history.replaceState(null,null,"/"),t=p):t="home";let a=PAGEDATA[t]||{control:{top:"msn",nav:"s"}};return"pdata"in sessionStorage?a=JSON.parse(sessionStorage.getItem("pdata")):sessionStorage.setItem("pdata",JSON.stringify(a)),e.searchParams.has("p")?(p=e.searchParams.get("p").toLowerCase()||"home",sessionStorage.setItem("page",p),p in PAGEDATA&&sessionStorage.setItem("pdata",JSON.stringify(PAGEDATA[p])),window.history.replaceState(null,null,"/"),[p,PAGEDATA[p]]):"page"in sessionStorage?[t,a]:(sessionStorage.setItem("page","home"),["home",PAGEDATA.home])},go2Page=(e,t)=>{d=d,console.log(e,t),startLoading(),t&&("string"==typeof t&&(t=PAGEDATA[t]),t.control&&(t.control.top.split("").forEach((a,o)=>{switch(o){case 0:"m"==a?(d.getElementById("backnavbutton").classList.add("d-none"),d.getElementById("menuopenbutton").classList.remove("d-none")):(d.getElementById("menuopenbutton").classList.add("d-none"),d.getElementById("backnavbutton").classList.remove("d-none"),t.back||(t.back={page:sessionStorage.getItem("page"),data:JSON.parse(sessionStorage.getItem("pdata"))}),d.getElementById("backnavbutton").onclick=(()=>{go2Page(t.back.page,t.back.data)}));break;case 1:"s"==a?(d.getElementById("searchnavbutton").classList.remove("d-none"),d.querySelector("#searchinput input").setAttribute("onclick",PAGESEARCH[e]+"(this.value)"),d.getElementById("searchclsbutton").click()):(d.getElementById("searchclsbutton").click(),d.getElementById("searchnavbutton").classList.add("d-none"));break;case 2:"m"==a?(()=>{m=d.getElementById("mmenunavbutton"),m.classList.remove("d-none"),li="";for(var e=0;e<t.control.menu.length;e++)li+="<li><a class=dropdown-item role=button onclick="+t.control.menu[e].a+"(this) tabindex=0>"+t.control.menu[e].t+"</a></li>";m.parentNode.querySelector(".dropdown-menu").innerHTML=li})():d.getElementById("mmenunavbutton").classList.add("d-none")}}),"s"==t.control.nav?(d.getElementById("navPages").classList.remove("d-none"),d.querySelectorAll("[data-nav-id]").forEach(e=>{e.dataset.navId==t.control.navTab?e.classList.add("active"):e.classList.remove("active")})):d.getElementById("navPages").classList.add("d-none"),d.getElementById("pageName").innerText=t.control.title||"")),console.log(t),"blank"!=e&&(sessionStorage.setItem("pdata",JSON.stringify(t)),sessionStorage.setItem("page",e)),t.back&&"blank"!=e?(history.pushState([t.back.page,t.back.data],e,"#"+e),history.pushState(null,e,"#f"+e)):history.pushState(null,e,"#"),e in PAGERENDER&&(f=PAGERENDER[e],f(t))};