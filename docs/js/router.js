String.prototype.formatUnicorn=String.prototype.formatUnicorn||function(){"use strict";var e=this.toString();if(arguments.length){var t,a=typeof arguments[0],n="string"===a||"number"===a?Array.prototype.slice.call(arguments):arguments[0];for(t in n)e=e.replace(new RegExp("\\{"+t+"\\}","gi"),n[t])}return e};const DBURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vROKYurp41BsWy1wIl60L4xRJVpzHC0Cz8ccuSID3s28OtcIUXGvGPBk08y8XowkSBkE7VfFEiegdCa/pub";function stopLoading(){d.getElementById("pagedataloading").classList.add("d-none")}function startLoading(e){!e&&setdata2page(""),d.getElementById("pagedataloading").classList.remove("d-none")}function setdata2page(e){d.getElementById("page-container").innerHTML=e}function searchInRoute(e){searchBody=d.querySelectorAll(".list-group-item").forEach(t=>{t.innerText.toUpperCase().indexOf(e.toUpperCase())>-1||!e?t.parentNode.style.display="flex":t.parentNode.style.display="none"})}const fetchCSV=e=>new Promise((t,a)=>{fetch(e).then(e=>e.text()).then(e=>{t(CSV.csvToObject(e,{trim:!0}))}).catch(e=>{a(e)})});let Oroutedetails=(e,t)=>{go2Page("blank",{control:{title:"",top:"bnn",nav:"h"}}),fetchCSV(DBURL+"?gid=1463143925&single=true&output=csv").then(a=>{let n={};for(var r=0;r<a.length;r++)a[r].route in n?n[a[r].route].push(a[r]):(n[a[r].route]=[],n[a[r].route].push(a[r]));go2Page("routedetails",{control:{title:n[e][t].drivern+" ("+n[e][t].date+")",top:"bnm",nav:"h",menu:[]},data:n[e][t]})})},shareRoute=(e,t)=>{[name,date]=Array.from(t.parentElement.parentElement.firstElementChild.firstElementChild.children).map(e=>e.innerText),navigator.share?navigator.share({title:name+" ("+date+")",url:"https://transfers.arendacg.space/?p=routedetails&id="+e}):!alert("Ссылка скопирована в буфер обмена")&&navigator.clipboard.writeText(name+" ("+date+") https://transfers.arendacg.space/?p=routedetails&id="+e),t.parentElement.parentElement.scrollBy({left:-1,behavior:"smooth"})},rPagehome=()=>{data=fetchCSV(DBURL+"?gid=1463143925&single=true&output=csv"),temp=fetch("/pages/home.html").then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html").querySelector("[template]"));let e={};finalOutput="",Promise.all([data,temp]).then(n=>{for(var o=0;o<n[0].length;o++)n[0][o].route in e?e[n[0][o].route].push(n[0][o]):(e[n[0][o].route]=[],e[n[0][o].route].push(n[0][o]));for(x in e){r=x.split(";"),t=n[1].cloneNode(!0),crdshhdr=t.querySelector(".flags-shema"),cntry=crdshhdr.querySelector("div"),cntry.setAttribute("country",r[0]);for(o=1;o<r.length;o++)ncntry=cntry.cloneNode(),ncntry.setAttribute("country",r[o]),crdshhdr.append(ncntry);lfr=t.querySelector(".list-group"),a=lfr.firstElementChild,nwa=a.cloneNode(!0),a.innerHTML=a.innerHTML.formatUnicorn(e[x][0]),id=e[x][0].driveru+"-"+e[x][0].date.replaceAll(".","")+"-"+e[x][0].route.replaceAll(";","-"),a.firstElementChild.setAttribute("onclick",'Oroutedetails("'+x+'",0)'),a.querySelector(".slidemenu .share").setAttribute("onclick",'shareRoute("'+id+'",this)'),a.querySelectorAll("i.Ttype").forEach((t,a)=>{1*e[x][0].type==a+1||1*e[x][0].type==3?t.classList.remove("d-none"):t.classList.add("d-none")});for(o=1;o<e[x].length;o++)tnwa=nwa.cloneNode(!0),id=e[x][o].driveru+"-"+e[x][o].date.replaceAll(".","")+"-"+e[x][o].route.replaceAll(";","-"),tnwa.innerHTML=nwa.innerHTML.formatUnicorn(e[x][o]),tnwa.firstElementChild.setAttribute("onclick",'Oroutedetails("'+x+'",'+o+")"),tnwa.querySelector(".slidemenu .share").setAttribute("onclick",'shareRoute("'+id+'",this)'),tnwa.querySelectorAll("i.Ttype").forEach((t,a)=>{1*e[x][o].type==a+1||1*e[x][o].type==3?t.classList.remove("d-none"):t.classList.add("d-none")}),lfr.append(tnwa);finalOutput+=t.outerHTML}console.log(n[0],n[1],e),stopLoading(),setdata2page(finalOutput),d.querySelectorAll("div[country]").forEach(e=>{e.style.background="url(https://hatscripts.github.io/circle-flags/flags/"+e.getAttribute("country")+".svg)"})})},rPagedrivers=()=>{data=fetchCSV(DBURL+"?gid=0&single=true&output=csv&range=B:F"),temp=fetch("/pages/drivers.html").then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html").querySelector("[template]"));let e="";Promise.all([data,temp]).then(t=>{for(driver of(e=t[1].firstElementChild.outerHTML,t[0]))e+=t[1].lastElementChild.outerHTML.formatUnicorn(driver);stopLoading(),setdata2page(e)})};const rPageRdetails=e=>{e.data?rPageRdetails_render(e.data):fetchCSV(DBURL+"?gid=1463143925&single=true&output=csv").then(e=>{myUrl=new URL(location.href);let t=myUrl.searchParams.get("id");if(t)return(t=t.split("-")).length<4?go2Page("home","home"):(finded=!1,e.forEach(e=>{if(e.driveru==t[0]&&e.date==t[1][0]+t[1][1]+"."+t[1][2]+t[1][3]+"."+t[1][4]+t[1][5]+t[1][6]+t[1][7]&&t.length==t.concat(e.route.split(";")).filter((e,t,a)=>a.indexOf(e)==t).length)return finded=!0,rPageRdetails_render(e,!0)}),finded?0:go2Page("home","home"));go2Page("home","home")})};function rPageRdetails_render(e,t=!1){t&&setTitle(e.drivern+"("+e.date+")"),setMenuItems([{a:"ShowToastMessage('Тестова провірка алертів')",t:"Call"}])}const PAGEDATA={home:{control:{title:"Рейсы",top:"msn",nav:"s",navTab:"1"}},drivers:{control:{title:"Водители",top:"msn",nav:"s",navTab:"2"}},routedetails:{control:{title:"",top:"bnm",nav:"h",menu:[]},back:{page:"home",data:"home"}},"add-driver":{control:{title:"Добавить перевозчика",top:"bnn",nav:"h"},back:{page:"home",data:"home"}},calendar:{control:{title:"Календарь",top:"bnn",nav:"h"}}},PAGERENDER={home:rPagehome,drivers:rPagedrivers,calendar:console.log,routedetails:rPageRdetails,driverdetails:console.log,"add-driver":console.log},PAGESEARCH={home:"searchInRoute",drivers:"console.log"};window.onpopstate=(e=>{e.state&&go2Page(...e.state)});const curPage=()=>{console.log("curpage");let e=new URL(window.location.href),t=sessionStorage.getItem("page")||"home",a=PAGEDATA[t];return"pdata"in sessionStorage?a=JSON.parse(sessionStorage.getItem("pdata")):sessionStorage.setItem("pdata",JSON.stringify(a)),e.searchParams.has("p")?(p=e.searchParams.get("p").toLowerCase()||"home",p in PAGEDATA&&(sessionStorage.setItem("pdata",JSON.stringify(PAGEDATA[p])),sessionStorage.setItem("page",p)),e.searchParams.delete("p"),window.history.replaceState(null,null,e),PAGEDATA[p]?[p,PAGEDATA[p]]:["home",PAGEDATA.home]):"page"in sessionStorage?(sessionStorage.setItem("page",t),[t,a]):(sessionStorage.setItem("page","home"),["home",PAGEDATA.home])};function setTitle(e){d.getElementById("pageName").innerText=e}function setMenuItems(e=[]){m=d.getElementById("mmenunavbutton"),m.classList.remove("d-none"),li="";for(var t=0;t<e.length;t++)li+='<li><a class=dropdown-item role=button onclick="'+(e[t].a.match(/\(.*\)/)?e[t].a:e[t].a+"(this)")+'" tabindex=0>'+e[t].t+"</a></li>";m.parentNode.querySelector(".dropdown-menu").innerHTML=li}const go2Page=(e,t)=>{console.log(e,t),startLoading(),t&&("string"==typeof t&&(t=PAGEDATA[t]),t.control&&(t.control.top.split("").forEach((a,n)=>{switch(n){case 0:"m"==a?(d.getElementById("backnavbutton").classList.add("d-none"),d.getElementById("menuopenbutton").classList.remove("d-none")):(d.getElementById("menuopenbutton").classList.add("d-none"),d.getElementById("backnavbutton").classList.remove("d-none"),t.back||(t.back={page:sessionStorage.getItem("page"),data:JSON.parse(sessionStorage.getItem("pdata"))}),d.getElementById("backnavbutton").onclick=(()=>{go2Page(t.back.page,t.back.data)}));break;case 1:"s"==a?(d.getElementById("searchnavbutton").classList.remove("d-none"),d.querySelector("#searchinput input").setAttribute("onclick",PAGESEARCH[e]+"(this.value)"),d.getElementById("searchclsbutton").click()):(d.getElementById("searchclsbutton").click(),d.getElementById("searchnavbutton").classList.add("d-none"));break;case 2:"m"==a?setMenuItems(t.control.menu):d.getElementById("mmenunavbutton").classList.add("d-none")}}),"s"==t.control.nav?(d.getElementById("navPages").classList.remove("d-none"),d.querySelectorAll("[data-nav-id]").forEach(e=>{e.dataset.navId==t.control.navTab?e.classList.add("active"):e.classList.remove("active")})):d.getElementById("navPages").classList.add("d-none"),setTitle(t.control.title||""))),console.log(t),"blank"!=e&&(sessionStorage.setItem("pdata",JSON.stringify(t)),sessionStorage.setItem("page",e)),t.back&&"blank"!=e?(history.pushState([t.back.page,t.back.data],e,"#d"+e),history.pushState(null,e,"#f"+e)):history.pushState(null,e,"#"),e in PAGERENDER&&(f=PAGERENDER[e],f(t))};