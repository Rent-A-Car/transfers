String.prototype.formatUnicorn=String.prototype.formatUnicorn||function(){"use strict";var e=this.toString();if(arguments.length){var t,n=typeof arguments[0],o="string"===n||"number"===n?Array.prototype.slice.call(arguments):arguments[0];for(t in o)e=e.replace(new RegExp("\\{"+t+"\\}","gi"),o[t])}return e};const stopLoading=()=>{document.getElementById("pagedataloading").classList.add("d-none")},startLoading=()=>{setdata2page(""),document.getElementById("pagedataloading").classList.remove("d-none")},setdata2page=e=>{document.getElementById("page-container").innerHTML=e},fetchCSV=e=>new Promise((t,n)=>{fetch(e).then(e=>e.text()).then(e=>{t(CSV.csvToObject(e,{trim:!0}))}).catch(e=>{n(e)})});let rPagehome=()=>{data=fetchCSV("https://docs.google.com/spreadsheets/d/e/2PACX-1vROKYurp41BsWy1wIl60L4xRJVpzHC0Cz8ccuSID3s28OtcIUXGvGPBk08y8XowkSBkE7VfFEiegdCa/pub?gid=1463143925&single=true&output=csv"),temp=fetch("/pages/home.html").then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html").querySelector("[template]")),routs={},finalOutput="",Promise.all([data,temp]).then(e=>{for(var n=0;n<e[0].length;n++)e[0][n].route in routs?routs[e[0][n].route].push(e[0][n]):(routs[e[0][n].route]=[],routs[e[0][n].route].push(e[0][n]));for(x in routs){r=x.split(";"),t=e[1].cloneNode(!0),crdshhdr=t.querySelector(".flags-shema"),cntry=crdshhdr.querySelector("div"),cntry.setAttribute("country",r[0]);for(n=1;n<r.length;n++)ncntry=cntry.cloneNode(),ncntry.setAttribute("country",r[n]),crdshhdr.append(ncntry);lfr=t.querySelector(".list-group"),a=lfr.firstElementChild,nwa=a.cloneNode(!0),a.innerHTML=a.innerHTML.formatUnicorn(routs[x][0]),a.setAttribute("onclick",'go2Page("routedetails",{control:{title:"'+routs[x][0].drivern+'",top:"bnn",nav:"h"}})');for(n=1;n<routs[x].length;n++)tnwa=nwa.cloneNode(!0),tnwa.innerHTML=nwa.innerHTML.formatUnicorn(routs[x][n]),tnwa.setAttribute("onclick",'go2Page(go2Page("routedetails",{control:{title:"'+routs[x][n].drivern+'",top:"bnn",nav:"h"}}))'),lfr.append(tnwa);finalOutput+=t.outerHTML}console.log(e[0],e[1],routs),stopLoading(),setdata2page(finalOutput),document.querySelectorAll("div[country]").forEach(e=>{e.style.background="url(https://hatscripts.github.io/circle-flags/flags/"+e.getAttribute("country")+".svg)"})})};const PAGEDATA={home:{control:{title:"Рейсы",top:"msn",nav:"s",navTab:"1"}},drivers:{control:{title:"Водители",top:"msn",nav:"s",navTab:"2"}},calendar:{control:{title:"Календарь",top:"bnn",nav:"h"}}},PAGERENDER={home:rPagehome,drivers:()=>{setTimeout(stopLoading,3e3)},calendar:console.log,routedetails:console.log},curPage=()=>{let e=new URL(window.location.href);page="","page"in sessionStorage?page=sessionStorage.getItem("page"):e.searchParams.has("p")?(p=e.searchParams.get("p").toLowerCase()||"home",window.history.replaceState(null,null,"/"),page=p):page="home";let t=PAGEDATA[page]||{control:{top:"msn",nav:"s"}};return"pdata"in sessionStorage?t=JSON.parse(sessionStorage.getItem("pdata")):sessionStorage.setItem("pdata",JSON.stringify(t)),e.searchParams.has("p")?(p=e.searchParams.get("p").toLowerCase()||"home",sessionStorage.setItem("page",p),p in PAGEDATA&&sessionStorage.setItem("pdata",JSON.stringify(PAGEDATA[p])),window.history.replaceState(null,null,"/"),[p,PAGEDATA[p]]):"page"in sessionStorage?[page,t]:(sessionStorage.setItem("page","home"),["home",PAGEDATA.home])},go2Page=(e,t)=>{d=document,console.log(e,t),setdata2page(""),document.getElementById("pagedataloading").classList.remove("d-none"),t&&("string"==typeof t&&(t=PAGEDATA[t]),t.control&&(t.control.top.split("").forEach((e,n)=>{switch(n){case 0:"m"==e?(d.getElementById("backnavbutton").classList.add("d-none"),d.getElementById("menuopenbutton").classList.remove("d-none")):(d.getElementById("menuopenbutton").classList.add("d-none"),d.getElementById("backnavbutton").classList.remove("d-none"),t.back||(t.back={page:sessionStorage.getItem("page"),data:JSON.parse(sessionStorage.getItem("pdata"))}),d.getElementById("backnavbutton").onclick=(()=>{go2Page(t.back.page,t.back.data)}));break;case 1:"s"==e?d.getElementById("searchnavbutton").classList.remove("d-none"):d.getElementById("searchnavbutton").classList.add("d-none");break;case 2:"m"==e?(()=>{m=d.getElementById("mmenunavbutton"),m.classList.remove("d-none"),li="";for(var e=0;e<t.control.menu.length;e++)li+="<li><a class=dropdown-item role=button onclick="+t.control.menu[e].a+"(this) tabindex=0>"+t.control.menu[e].t+"</a></li>";m.parentNode.querySelector(".dropdown-menu").innerHTML=li})():d.getElementById("mmenunavbutton").classList.add("d-none")}}),"s"==t.control.nav?(d.getElementById("navPages").classList.remove("d-none"),d.querySelectorAll("[data-nav-id]").forEach(e=>{e.dataset.navId==t.control.navTab?e.classList.add("active"):e.classList.remove("active")})):d.getElementById("navPages").classList.add("d-none"),d.getElementById("pageName").innerText=t.control.title||"")),console.log(t),sessionStorage.setItem("pdata",JSON.stringify(t)),sessionStorage.setItem("page",e),e in PAGERENDER&&(f=PAGERENDER[e],f(t))};